\documentclass[12pt]{article}%
\input{prefix}%



\begin{document}
	
\title{Fault tolerant spanners}
\author{%
   Stav Ashur%
   \StavThanks{}%
   \and%
   Sariel Har-Peled%
   \SarielThanks{Work on this paper was partially supported by a
      NSF AF award CCF-1907400.  }%
}%
	
\maketitle
	
\section{Introduction}
	
Let $\FF$ be a family of regions in the plane, which we call the fault
regions. For a fault region $F\in \FF$ and a geometric graph $G$ on a
point set $P$ , we define $G\ominus F$ to be the part of $G$ that
remains after the points of $P$ that are contained in $F$, and all the
edges of $G$ that intersect $F$ have been removed from the graph. For
simplicity, we assume that a region fault $F$ does not contain its
boundary, i.e., only vertices and edges intersecting the interior of
$F$ will be affected.
	
	
Let $\LL$ be a family of regions in the plane, which we call the local
regions. For a local region $L\in \LL$ and a geometric graph $G$ on a
point set $P$ , we define $G\mid_F$ to be the part of $G$ contained in
the interior of $F$, meaning only the vertices and edges that are
fully contained in the interior of $F$.
	
Formally, given $G=(P,E)$:
	
$$G\ominus F = (p\setminus F, \{e\in E~|~ e\cap F = \emptyset\})$$

$$G\mid_F = (p \cap F, \{e\in E~|~ e\subseteq F\})$$
	
\paragraph{The problems:}

\begin{enumerate}
    \item Given a set $P$ of points in $\Re^2$, and a family $\FF$ of
    regions, compute a graph $G$ such that $G\ominus F$ is a
    $t$-spanner of $P$ for any fault $F\in\FF$
    \item Given a set $P$ of points in $\Re^2$, and a family $\LL$ of
    regions, compute a graph $G$ such that $G\mid_F$ is a $t$-spanner
    for any local region $L\in\LL$
\end{enumerate}
.

	
\section{Complement of disk faults / disk local spanners}
	
	
\section{Convex faults / disk local spanners}
Let $\FF$ be the set of convex regions, and $\eps>0$. We use the
construction of Abam \etal \cite{abfg-rftgs-09} in order to create a
$(1+\eps)$-$\FF$ tolerant spanner. In their paper, Abam \etal build a
\emph{semi separated pair decomposition} (SSPD), and add a set of
carefully chosen edges between every two sets $A,B\subseteq P$ that
compose a pair in the SSPD. Given a pair $(A,B)$, the algorithm
partitions the larger set, w.l.o.g it is $B$, by shooting rays at
fixed angular intervals from a disk that contains $A$, and then adds a
planar set of edges $E_i$ between the convex hulls of $A$ and every
part $B$ of $B$, that has the following property:

For any half-plane $H$ such that $A\cap H\neq \emptyset$ and
$B\cap H\neq \emptyset$, there exists an edge $e\in E_i$ such that
$e\subseteq H$. This property, together with the properties of the
SSPD, makes the resulted graph an $\FF$-fault tolerant spanner.

We notice, that a similar construction that chooses $E_i$ to be the
edges of the Delaunay triangulation with one end in $A$ and the other
in $B$ has the same property. We now prove that for any disk
$d\subseteq \Re^2$, and for any set $P'$ of points we have that
$\DT(P')\mid_d$ is connected. This is enough as half-planes can be
simulated by complements of disks.

\begin{claim}
    For a set of points $P\subseteq \Re^2$ and for any disk $d$,
    $\DT(P)\mid_d$ is connected.
\end{claim}

\begin{proof}
    We prove a different claim that immediately implies the desired
    one. Let $d$ be a disk with two points $p,q\in P$ on its
    boundary. Then there is a path between $p$ and $q$ in
    $\DT(P)\mid_d$. This is enough as for every two points $p,q$ and a
    disk $d$ containing them, we can get a disk $d'$ that contains $p$
    and $q$ on it's boundary by moving the center of $d$ in an
    arbitrary direction until either of them, say $p$ is on the
    boundary, and them moving the center of the disk towards $p$ while
    shrinking the size of the disk to maintain $p$ on the boundary,
    until $q$ as well is on the boundary.
    
    We prove by induction over the number points in the interior of
    $d$.
    
    $|d\cap (P\setminus \partial d)| = 0$: Then by construction of the Delaunay triangulation the edge $\{p,q\}$ is in $\DT(P)$ and is contained in the interior of $D$.\\
    
    $|d\cap (P\setminus \partial d)| > 0$: Let $x\in P$ be a point in
    the interior of $d$. We move the center of $d$ in the direction of
    $p$, shrinking $d$ in the process, until we get a disk
    $d'\subseteq d$ such that $x$ is on the boundary of $d'$. By
    induction there is a path between $p$ and $x$ in $\DT\mid_{d'}$,
    and since $\DT\mid_{d'}\subseteq \DT\mid_{d}$ we have that the
    same path exists in $\DT\mid_{d}$. The same proof gives us a path
    between $x$ and $q$ and thus we are done.
    
\end{proof}

Since the triangulation is planar, all of the arguments from the
original paper regarding the size of the spanner hold, and we get a
$(1+\eps)-\FF$ fault tolerant spanner of size $O(\eps^{-3}n\log n)$ in
$O(\eps^{-2}n\log n)$ time.

\section{Complement of convex faults / convex local spanners}
Using the same argument, we can extend the result for the case where
$\LL$ is the set of all scaled and translated copies, homothets, of a
convex shape $\CC$. While the Delaunay triangulation is not well
defined for all convex shapes, the operation of creating edges between
two points $p,q\in P$ such that there exist a homothet of $\CC$ that
contains only $p$ and $q$ and no other point of $P$ is always well
defined, and gives us a graph known as the $\CC$-Delaunay graph of
$P$, and denoted $\DG_{\CC}(P)$. The above proof applies almost
verbatim for any convex $\CC$, and proves the connectivity of
$\DG_{\CC}(P)$ for any $L\in \LL$.

We need only to define a suitable shrinking operation for convex
region towards a point, which is possible, for example, by
parameterizing the curve defining the region and leaving the desired
point in the same coordinate of the smaller curve. So, we get a
$(1+\eps)-\LL$ local spanner of size $O(\eps^{-3}n\log n)$ in
$O(\eps^{-2}n\log n)$ time.(

%	TODO: this is actually not true unless we know how to build
% \DG_{\C}(P)

%	Since the Delaunay triangulation is well defined for the
% \emph{polygonal convex distance} (L.P. Chew and
% R.L. Drydale. Voronoi diagrams based on convex distance
% functions.In 1st SoCG, pages 234â€“244, ACM
% Press, 1985), we can use the exact same proof (again replacing only
% the distance function and the disk) to get an algorithm for this
% entire family of problems.

	\section{$\eps$-shadow}

In this section we consider a weaker form of fault tolerance. Given a family $\LL$ of shapes, we say that $G$ is a $(\LL,\eps)$-local spanner if for any $L\in\LL$ we have that $G\mid_{L_{\eps}}$, where $L_{\eps}$ is $L$ rescaled by $(1-\eps)$, is a $t$-spanner. We call $L\setminus L_{\eps}$ the \emph{shadow} of $L$, and we say that a point $p$ is \emph{truly contained} in $L$ w.r.t. $\eps$, and denote $p\in_{\eps} L$, if $p\in L_{\eps}$. 

\subsection{Bounded aspect ratio rectangles}
Let $\LL$ be the set of axis parallel rectangles with aspect ratio at most $1<\alpha$. We repeatedly preform the algorithm for convex local spanners with rectangles of different aspect-ratio, where in the $i$-th iteration we use a rectangle with aspect ratio $\left(1+\eps\right)^i$, where $i\in\{0,...,\log_{1+\eps}(\alpha)\}$. 

Let $r$ be a rectangle with aspect ratio $\alpha$, and let $(A,B)$ be a pair in an SSPD such that $A\cap r\neq \emptyset$, and $B\cap r\neq \emptyset$. We assume w.l.o.g that the height of $r$ is 1, and its width is $\alpha'\in [1,\alpha]$.

Let $i\in \{0,...,\log_{1+\eps}(\alpha)\}$ be an index for which $\alpha' \leq (1+\eps)^i \leq \frac{\alpha}{1-\eps}$ if such an index exists, then let $r'$ be the rectangle with width $\alpha'$ and aspect ratio $(1+\eps)^i$, whose horizontal bisector coincides with that of $r$. Since $(1+\eps)^i \leq \frac{\alpha}{1-\eps}$, we have that $r\setminus r'$ is contained within the shadow of $r$, and therefore $r'$ contains points of both $A$ and $B$, from the correctness of the convex local spanner, we will have an edge between a point in $A\cap r'$ and a point in $B\cap r'$. As before, this, together with the properties of the SSPD, is enough to guarantee that the constructed graph is indeed a $(\LL, \eps)$-$t$-spanner (for the appropriate choice of the parameter $s$ of the SSPD).

We are left with proving that there exists an index $i\in \{0,...,\log_{1+\eps}(\alpha)\}$ for which $\alpha' \leq (1+\eps)^i \leq \frac{\alpha}{1-\eps}$.

$$\alpha' \leq (1+\eps)^i \leq \frac{\alpha}{1-\eps}$$

$$\log_{1+\eps}(\alpha') \leq i \leq \log_{1+\eps}\left(\frac{\alpha}{1-\eps}\right)$$

$$\log_{1+\eps}(\alpha') \leq i \leq \log_{1+\eps}(\alpha) - \log_{1+\eps}(1-\eps)$$

If $\log_{1+\eps}(1-\eps)<-1$, then there must be an integer $i$ with the required properties. We now notice that $(1+\eps)^{-1}=\frac{1}{1+\eps}>(1-\eps)$ [since $1>(1-\eps)(1+\eps)=(1-\eps^2)$], and so $i$ exists.

The size of the spanner is $\log_{1+\eps}(\alpha)$ times the number of edges in a convex local spanner, and since $\log_{1+\eps}(\alpha)=O\left(\frac{\log(\alpha)}{\eps}\right)$, we have a spanner of size $O\left(\frac{\log(\alpha)}{\eps (t-1)^{-3}}n\log n\right)$

\subsection{QSPD}

In order to construct local spanners for the family $\LL$ of axis parallel rectangles with $\eps$-shadow, we describe a decomposition of the the point set $P\subseteq \Re^d$ in to pairs of sets, a decomposition which we name a Quadrant Separated Pair Decomposition (QSPD). This decomposition gives us $O(n\log^{d-1}n)$ pairs $(A_i,B_i)$ of subsets of $P$, with overall size $O(n\log^{d}n)$, such that the sets can be separated by $d$ orthogonal axis parallel hyperplanes, and for every two points $p,q\in P$, there exists a single pair $(A_i,B_i)$ such that (w.l.o.g) $p\in A_i$, $q\in B_i$. For clarification, this separation in $\Re^d$ can be viewed as if one of the sets lies in the first quadrant of the plane (i.e. every point has positive $x$ and $y$ values), and the other is in the third quadrant (i.e. every point has negative $x$ and $y$ values), hence the name.

The construction of the decomposition can be described as a recursive process in which a call to the function with $p\subseteq \Re^d$ of size $n$ invokes a single call to a lower dimensional case, and two calls to $d$-dimensional cases, each with half of the points. The function goes as follows.

Given a set $P\subseteq \Re^d$ and a coloring $c:P\longrightarrow \{0,1\}^k$ for some $k$, the function $f(P,c)$ finds a median of $P$ w.r.t. the $d$-th dimension, and projects the points $P$ onto a hyperplane $h$ orthogonal to the same dimension passing through the median. Let the projected set of points be denoted $P'$, the $\frac{n}{2}$ points of $P$ the lie above $h$ be denoted $P^+$, $P\setminus P^+$ be denoted $P^-$, and let $c'$ be the coloring defined by  $c'(p)=c(p)\oplus b$ where $\oplus$ is the concatenation operator, and $b=1$ if $p\in P^+$, and $p=0$ otherwise.

The function then calls $f(P', c')$, $f(P^+, c^+)$, and $f(P^-, c^-)$, where $c^+$ and $c^-$ are $c$ limited to the set $P^+$ and $P^-$ respectively.

In the case where $d=1$, after finding the median w.r.t. the single dimension and defining $c'$, instead of invoking a lower dimensional call, the function creates $2^{d-1}$ pairs by taking all of the points with the same value $x\in\{0,1\}^d$ under $c'$, and pairing that set with the set all of the points with value $y\in\{0,1\}^d$ such that $\forall 1\leq i\leq d~:~ x^{(i)}\neq y^{(i)}$.


\begin{claim}
	The process described above creates a QSPD with size $O(n\log^dn)$ in $O_d(n\log^dn)$ time.
\end{claim}

\begin{proof}
	By construction, each reported pair is separated by $d$ orthogonal axis parallel hyperplanes, and any two points appear in opposing quadrants exactly once, as every recursive call which assigns different bits of the coloring to two points, separates these points in the next recursive calls. 
	
	The size of the structure is given by the following recursion formula:
	$$S(n,d) = S(n,d-1) + 2S\left(\frac{n}{2},d\right)$$
	
	In the base case where $d=1$, the formula is slightly different, as instead of recursing in a lower dimension it directly adds pairs. The formula is:
	
	$$S(n,1) = O(n) + 2S\left(\frac{n}{2},1\right)$$
	
	which solves to $O_d(n\log n)$. This means that the general case is 
	
	$$S(n,d) = O(n\log^{d-1}n) + 2S\left(\frac{n}{2},d\right)$$
	
	which solves to $O(n\log^d n)$.
	
	By using $d$ sorted arrays, one for each dimension, we get that the same recursion formulas hold for the runtime of the algorithm.
\end{proof}

\subsection{Arbitrary rectangles}

Let $P\subseteq \Re^2$. We first describe a subroutine for connecting two sets of points, $A$ and $B$, where $A$ is contained in $Q^-$, the negative quadrant of the plane (i.e., have a negative value $x$-coordinate and a negative value $y$-coordinate), and $B$ is contained in $Q^+$, the positive quadrant of the plane. 

Our algorithm will connect every point in $A$ to $O\left(\frac{1}{\eps^2}\right)$ points in the positive quadrant, and after performing the same process for the points of the symmetrically defined $B'$, we will have that every rectangle that truly contains points from $A$ and $B$ will have an edge $(a,b)$ with $a\in A$ and $b\in B$.

For every point $a = (x',y') \in A$ we define partition the positive quadrant into $O\left(\frac{1}{\eps^2}\right)$ sets. We consider the following $\frac{1}{\eps}$ horizontal stripes - $\forall j\in \{1,...,\frac{1}{\eps}\}$:

$$H_{j}:=\{(x,y)~|~  0 \leq x \leq x'+y'  ,~ (j-1)\cdot \eps y' < y \leq j\cdot \eps y'\}$$

On top of these we add similarly built vertical stripes:

$$V_{i}:=\{(x,y)~|~ (j-1)\cdot \eps x' < x \leq j\cdot \eps x',~ 0 \leq y \leq x'+y' \}$$

These stripes create a grid which partitions the rectangle $r$ whose opposite corners are $(0,0)$ and $(|x'|,|y'|)$ into $\frac{1}{\eps^2}$ cells of width $\eps x$ and height $\eps y$. Formally:

$$C_{i,j}:=\{(x',y')~|~  (i-1)\cdot \eps x < x' \leq i\cdot \eps x,~ (j-1)\cdot \eps y< y' \leq j\cdot \eps y\}$$

We now divide the parts of the stripes that lie outside of the rectangle $r$. The horizontal stripes are divided into cells of width $\eps(x+y)$ and height $\eps y$, and the vertical stripes are divided into cells of width $\eps y$and height $\eps(x+y)$. The extremal cell in each stripe may be smaller if $x$ or $y$ are not divisible by $\eps(x+y)$. Formally:

$$C_{H_{i,j}}:=\{(x',y')~|~  x' + (i-1)\cdot \eps (x+y) < x' \leq x' + i\cdot \eps (x+y),~ (j-1)\cdot \eps y< y' \leq j\cdot \eps y\}$$

$$C_{V_{i,j}}:=\{(x',y')~|~  (i-1)\cdot \eps x < x' \leq i\cdot \eps x,~ y + (j-1)\cdot \eps (x+y)< y' \leq y + j\cdot \eps (x+y)\}$$

The entire construction can be seen in Figure~\ref{fig:grid_construction}. We can now describe the construction of our spanner. For $P\subseteq \Re^2$ we create a QSPD of $P$, and for every pair $(A,B)$ we add an edge between every point $a\in A$ (and later reverse the rolls inside the pair) to an arbitrary point of $P$ in every cell $C_{i,j}$, to the leftmost point of $P$ in every $C_{H_{i,j}}$, and to the bottom-most point of $P$ in every $C_{V_{i,j}}$.

We now prove a lemma that summarizes the properties of the resulted graph, and which we will then use to prove that our construction produces an $(\LL, eps)$- local $t$-spanner for the family of arbitrary axis parallel rectangles. 

\begin{figure}
	\centering
	\includegraphics[width=\linewidth, page=3]{figs/grid_construction.pdf}
	\label{fig:grid_construction}
	\caption{The construction of the grid for the arbitrary axis parallel rectangle local spanner.}
\end{figure}


\begin{claim}
	\label{clm:long_jump}
	For any two points $a,b\in P$ that are properly contained in an axis parallel rectangle $r$ ,and are not connected by an edge, there exists a point $b'\in r$ such that if w.l.o.g $||b-b'|| \leq ||a-c||$ then:
	\begin{enumerate}
		\item $||b-b'|| \leq 3\eps ||a-b||)$, and
		\item there is an edge between $a$ and $b'$. 
	\end{enumerate}
	
\end{claim}

\begin{proof}
	Let $(A,B)$ be the unique pair of the QSPD such that w.l.o.g $a\in A$ and $b\in B$, $A\subseteq Q^-$, $B\subseteq Q^+$, and $||b||_{1} \leq ||a||_{1}$. We denote the absolute value of the coordinates of a point $p$ by $p.x$ and $p.y$ for the $x$ and $y$ coordinates respectively. If $b.x \leq a.x$ and $b.y \leq a.y$, then by the construction, $a$ is connected to a point $b'$ in the cell $C_{i,j}$ containing $b$. Since the cell's dimensions are $\eps\cdot a.x \times \eps a.y$, we have that $C_{i,j}\subseteq r$, and also:
	
	$$||b-b'||\leq \sqrt{(\eps\cdot a.x)^2+(\eps\cdot a.y)^2}=\eps\sqrt{a.x^2+a.y^2}\leq \eps(a.x+a.y) \leq 2\eps||a-b||$$
	
	regardless of the choice of $b'$, as $||a-b||\geq||a-(0,0)||\geq \frac{a.x+a.y}{2}$. 
	
	If w.l.o.g $a.x\leq b.x$, then since $||b||_{1} \leq ||a||_{1}$ we know that $b.y \leq a.y$ meaning that $b$ is contained in some cell $C_{H_{i,j}}$. Again, due to the dimensions of $C_{H_{i,j}}$ (which are $\eps\cdot a.y \time \eps\cdot(a.x+a.y)$) we have that $b'$, the leftmost point of $P$ in $C_{H_{i,j}}$, is contained in $r$, and also:
	
	$$||b-b'||\leq \sqrt{(\eps (a.x+a.y))^2+(\eps\cdot a.y)^2}\leq \sqrt{2(\eps (a.x+a.y))^2} $$
	$$=\sqrt{2}\eps(a.x+a.y) \leq \sqrt{8}\eps||a-b||$$
	
\end{proof}

We are left with proving that for a suitable choice of parameters, this construction results in a $(\LL,\eps)$ local $t$-spanner.


%TODO: this can probably be done faster than the naive way.
\begin{claim}
	It is possible to construct a $(\LL, eps')$ local $(1+\eps'')$-spanner of size $O\left(\frac{1}{\min\{\eps, \eps'\}}n\log^2n\right)$ in ??? time.
\end{claim} 

\begin{proof} 
	Let $\eps = \alpha \min \{\eps',\eps''\}$ for some $\alpha \geq 3$. We build a spanner using $\eps$ as the parameter for the edge construction process. Due to the choice of $\eps$ we have that all of the properties proven in Claim~\ref{clm:long_jump} are true, and therefore we have that for 
\end{proof}


\subsection{Bounded aspect ratio triangles}

The aspect ratio of a triangle is defined as the length of its longest
edge divided by its height as it is measured from that edge. Let $\LL$
be the set of all triangles with aspect ratio at most $\alpha$ for
some $1 < \alpha$. We define a set of slopes, and for each subset of 3
slopes we run the convex region algorithm with $\LL$ as homothets of a
triangle with edges of the 3 chosen slopes. As long as the fixed
angular interval is smaller than
$\eps' = \arctan\left(\frac{\eps/2}{\alpha(1-\eps/2)}\right)$ (see
\figref{triangle_with_shadow}).

This construction creates $\frac{1}{\eps'}$ different convex local
spanners, and so we get a $(1+\eps)$-local spanner for triangles with
bounded aspect ratio in
$O\left(\frac{1}{\eps'^3\eps^3} n\log n\right)$.


\begin{figure}
    \centering
    \includegraphics[width=0.6\linewidth]{figs/triangle_shadow}
    \figlab{triangle_with_shadow}
\end{figure}


\bibliographystyle{alpha} 
%\bibliography{shortcuts,geometry}
\bibliography{ft_spanner}

\end{document}
